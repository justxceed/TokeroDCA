<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:models="clr-namespace:TokeroDCA.Models"
             x:Class="TokeroDCA.Views.DCASetupPage"
             Title="DCA Setup"
             Padding="15">

    <Grid>
        <StackLayout 
            Spacing="10"
            IsVisible="{Binding IsBusy, Converter={toolkit:InvertedBoolConverter}}">

            <Label Text="Select a Coin" FontAttributes="Bold" />
            <Picker ItemsSource="{Binding Coins}"
                    ItemDisplayBinding="{Binding Name}"
                    SelectedItem="{Binding SelectedCoin}"
                    HorizontalOptions="FillAndExpand" />

            <Label Text="Monthly Investment Amount (â‚¬)" FontAttributes="Bold" />
            <Entry Keyboard="Numeric"
                   Text="{Binding MonthlyAmount, Mode=TwoWay}"
                   Placeholder="e.g., 100" />

            <Button Text="Add coin"
                    Command="{Binding AddCoinCommand}"
                    HorizontalOptions="FillAndExpand" />

            <Border
                Stroke="LightGray"
                StrokeThickness="1"
                StrokeShape="RoundRectangle 10,10,10,10"
                Padding="0,0,0,10"
                BackgroundColor="White">
                <Border.Shadow>
                    <Shadow Brush="Gray"
                            Offset="4,4"
                            Radius="10"
                            Opacity="0.5" />
                </Border.Shadow>
                <CollectionView
                    ItemsSource="{Binding SetupItems}"
                    HorizontalOptions="FillAndExpand">
                    <CollectionView.Header>
                        <Grid
                            Grid.ColumnDefinitions="*,*"
                            Padding="20,10"
                            ColumnSpacing="10"
                            BackgroundColor="LightGray">

                            <Label
                                Text="Coin"
                                HorizontalTextAlignment="Start"
                                VerticalOptions="Center"
                                Grid.Column="0" />
                            <Label
                                Text="Monthly Investment"
                                HorizontalTextAlignment="End"
                                VerticalOptions="Center"
                                Grid.Column="1" />
                        </Grid>
                    </CollectionView.Header>
                    <CollectionView.ItemTemplate>
                        <DataTemplate
                            x:DataType="models:DCASetupItem">
                            <Grid
                                Padding="20,5"
                                ColumnDefinitions="*,auto">
                                <Label
                                    Grid.Column="0"
                                    Text="{Binding Coin.Name}" />
                                <Label
                                    Grid.Column="1"
                                    Text="{Binding AmountInvested}" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.Footer>
                        <Grid
                            Padding="20,5"
                            RowDefinitions="auto,auto,auto"
                            ColumnDefinitions="*,auto">
                            <BoxView
                                Grid.Row="0"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                HeightRequest="1"
                                Margin="0,0,0,10"
                                HorizontalOptions="Fill"
                                Color="LightGray" />
                            <Label
                                Grid.Row="1"
                                Grid.Column="0"
                                Text="Total" />
                            <Label
                                Grid.Row="1"
                                Grid.Column="1"
                                Text="{Binding TotalMonthlyAmount}" />
                            <Button
                                Grid.Row="2"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                Margin="0,10,0,0"
                                Text="Reset"
                                Command="{Binding ResetCommand}"
                                HorizontalOptions="FillAndExpand" />
                        </Grid>
                    </CollectionView.Footer>
                </CollectionView>
            </Border>

            <Label Text="Start Date" FontAttributes="Bold" />
            <DatePicker Date="{Binding StartDate}" />

            <Label Text="Day of Month for Investment" FontAttributes="Bold" />
            <Entry Keyboard="Numeric"
                   Text="{Binding DayOfMonth, Mode=TwoWay}"
                   Placeholder="1 - 28" />

            <Button Text="Start DCA Simulation"
                    Command="{Binding SubmitCommand}"
                    HorizontalOptions="FillAndExpand" />

        </StackLayout>
        <VerticalStackLayout 
            HorizontalOptions="Center"
            VerticalOptions="Center"
            Spacing="20"
            IsVisible="{Binding IsBusy}">
            <Label Text="Computing..."/>
            <ActivityIndicator IsRunning="{Binding IsBusy}"/>
        </VerticalStackLayout>
    </Grid>
</ContentPage>